/* Module servant à définir des types et routines pour les périphériques
 * de l'ordinateur (souris, clavier, etc.). */

importe Math
importe MIME

/* ------------------------------------------------------------------------- */
/** \nom TypeCurseurSystème.
 * \{ */

TypeCurseurSystème :: énum {
    /* Curseur invisible, nul. */
    VIERGE
    /* Curseur en forme de flèche (défaut sur la plupart des systèmes). */
    FLÈCHE
    /* Curseur en forme de I pour indiquer une insertion de texte. */
    TEXTE
    /* Curseur indiquant d'attendre sur une tâche. */
    ATTENTE
    /* Curseur en forme de cible. */
    CROIX
    /* Flèche avec une attente. */
    FLÈCHE_AVEC_ATTENTE
    /* Double flèche diagonale pointant nord-ouest sud-est. */
    FLÈCHE_DOUBLE_NOSE
    /* Double flèche diagonale pointant nord-est sud-ouest. */
    FLÈCHE_DOUBLE_NESO
    /* Double flèche horizontale. */
    FLÈCHE_DOUBLE_HORIZONTALE
    /* Double flèche verticale. */
    FLÈCHE_DOUBLE_VERTICALE
    /* Superposition de toutes les doubles flèches. */
    FLÈCHE_DOUBLE_TOUT
    /* Curseur indiquant que quelque chose est interdit. */
    INTERDIT
    /* Curseur représentant une main ouverte. */
    MAIN_OUVERTE
    /* Curseur représentant une main fermée. */
    MAIN_FERMÉE
}

/** \} */

/* ------------------------------------------------------------------------- */
/** \nom ClicSouris
 * \{ */

ModificateurClavier :: énum_drapeau {
    COMMANDE_OS
    CONTROL
    MAJUSCULE
    OPTION
    ALT
}

ÉtatSouris :: struct {
    quand: z64 // le temps où l'état a été enregistré
    où: Point2D(z32) // là où la souris se trouve
    modificateur: ModificateurClavier
}

ActionSouris :: énum {
    PRESSÉE
    RELACHÉE
    DÉPLACÉE
    ROULEMENT
    DOUBLE_CLIC
}

BoutonSouris :: énum {
    AUCUN
    PRIMAIRE
    CONTEXTUEL
    TERTIAIRE
    AVANT
    ARRIÈRE

    GAUCHE :: PRIMAIRE
    DROIT :: CONTEXTUEL
    MOLETTE :: TERTIAIRE
}

ClicSouris :: struct {
    état: ÉtatSouris
    action: ActionSouris
    bouton: BoutonSouris
    /* Delta pour la molette. */
    delta: z32
}

/** \} */

/* ------------------------------------------------------------------------- */
/** \nom RaccourcisClavier
 * \{ */

InfoToucheClavier :: struct {
    type: ToucheClavier
    texte: chaine
}

/** \} */

/* ------------------------------------------------------------------------- */
/** \nom RaccourcisClavier
 * \{ */

RaccourcisClavier :: struct {
    clé: ToucheClavier
    modificateur: ModificateurClavier
}

opérateur == :: (a: RaccourcisClavier, b: RaccourcisClavier) -> bool
{
    retourne a.clé == b.clé && a.modificateur == b.modificateur
}

ctrl :: fonc (clé: ToucheClavier) -> RaccourcisClavier
{
    résultat: RaccourcisClavier
    résultat.modificateur = ModificateurClavier.CONTROL
    résultat.clé = clé
    retourne résultat
}

ctrl_maj :: fonc (clé: ToucheClavier) -> RaccourcisClavier
{
    résultat: RaccourcisClavier
    résultat.modificateur.CONTROL = vrai
    résultat.modificateur.MAJUSCULE = vrai
    résultat.clé = clé
    retourne résultat
}

/** \} */

/* ------------------------------------------------------------------------- */
/** \nom Clavier
 * \{ */

ToucheClavier :: énum {
    INCONNUE

    A
    B
    C
    D
    E
    F
    G
    H
    I
    J
    K
    L
    M
    N
    O
    P
    Q
    R
    S
    T
    U
    V
    W
    Y
    X
    Z

    _0
    _1
    _2
    _3
    _4
    _5
    _6
    _7
    _8
    _9

    ENTRÉE
    EFFACE
    ÉCHAPPE
    TAB

    VIRGULE
    ESPACE
    POINT_VIRGULE
    DOUBLE_POINT
    POINT_EXCLAMATION

    POINT
    APOSTROPHE
    ACCENT_GRAVE
    MOINS
    PLUS
    SLASH
    BACK_SLASH
    ÉGAL
    CROCHET_OUVRANT
    CROCHET_FERMANT
    PAUSE
    PARENTHÈSE_GAUCHE
    PARENTHÈSE_DROITE
    ESPERLUETTE
    E_ACCENT_AIGÜE
    E_ACCENT_GRAVE
    TIRET_BAS
    C_CÉDILLE
    A_ACCENT_GRAVE
    GUILLEMET_ANGLAIS
    U_ACCENT_GRAVE
    ASTÉRISQUE
    DOLLAR
    EXCLAMATION
    INFÉRIEUR

    MAJUSCULE_GAUCHE
    MAJUSCULE_DROITE
    CONTROLE_GAUCHE
    CONTROLE_DROITE
    ALT_GAUCHE
    ALT_DROITE
    SYSTÈME_GAUCHE
    SYSTÈME_DROITE
    HYPER_GAUCHE
    HYPER_DROITE

    FLÈCHE_GAUCHE
    FLÈCHE_DROITE
    FLÈCHE_HAUT
    FLÈCHE_BAS

    PAGE_HAUT
    PAGE_BAS
    DÉBUT
    FIN
    INSÉRER
    SUPPRIMER

    VERROUILLAGE_CASSE
    ARRÊT_DÉFILAGE
    VERROUILLAGE_NUMÉRIQUE
    APPLICATION

    PAVÉ_NUM_0
    PAVÉ_NUM_1
    PAVÉ_NUM_2
    PAVÉ_NUM_3
    PAVÉ_NUM_4
    PAVÉ_NUM_5
    PAVÉ_NUM_6
    PAVÉ_NUM_7
    PAVÉ_NUM_8
    PAVÉ_NUM_9
    PAVÉ_NUM_POINT

    PAVÉ_NUM_INSÈRE
    PAVÉ_NUM_FIN
    PAVÉ_NUM_BAS
    PAVÉ_NUM_PAGE_BAS
    PAVÉ_NUM_GAUCHE
    PAVÉ_NUM_DROITE
    PAVÉ_NUM_DÉBUT
    PAVÉ_NUM_HAUT
    PAVÉ_NUM_PAGE_HAUT
    PAVÉ_NUM_SUPPR

    PAVÉ_NUM_ENTRÉE
    PAVÉ_NUM_PLUS
    PAVÉ_NUM_MOINS
    PAVÉ_NUM_ASTÉRISQUE
    PAVÉ_NUM_SLASH

    F1
    F2
    F3
    F4
    F5
    F6
    F7
    F8
    F9
    F10
    F11
    F12
    F13
    F14
    F15
    F16
    F17
    F18
    F19
    F20
    F21
    F22
    F23
    F24
    F25
    F26
    F27
    F28
    F29
    F30
    F31
    F32
    F33
    F34
    F35

    LECTURE_MÉDIA
    PAUSE_MÉDIA
    MÉDIA_PRÉCÉDENT
    RECULE_MÉDIA
    MÉDIA_SUIVANT
    AVANCE_MÉDIA
}

/** \} */

/* ------------------------------------------------------------------------- */
/** \nom Évènement
 * \{ */

TypeÉvènement :: énum {
    NonInitialisé
    Fermeture
    Souris
    Clavier
    Déposer
    // Tablette
    // Window
    // Molette séparée de souris ?
    // Entrée texte séparée de clavier hors IME ?
}

Évènement :: struct {
    type: TypeÉvènement

    /* Pour les évènements souris. */
    état_souris: ÉtatSouris
    action_souris: ActionSouris
    bouton_souris: BoutonSouris
    /* Delta pour la molette. */
    delta_souris: z32

    /* Pour les évènements clavier. */
    touche: ToucheClavier
    modificateurs: ModificateurClavier
    touche_pressée: bool
    est_répétée: bool
    texte: chaine
    compte: z32
    code_scan_natif: n32
    modificateurs_natifs: n32
    clé_virtuelle_native: n32

    /* Mimes pour un déposer. */
    mimes: [..]DonnéesMime
}

donne_clic_souris :: fonc (empl évènement: &Évènement) -> ClicSouris
{
    clic: ClicSouris = ---
    clic.état = état_souris
    clic.action = action_souris
    clic.bouton = bouton_souris
    clic.delta = delta_souris
    retourne clic
}

initialise_depuis_clic :: fonc (évènement: *Évènement, clic: ClicSouris)
{
    évènement.type = TypeÉvènement.Souris
    évènement.état_souris = clic.état
    évènement.bouton_souris = clic.bouton
    évènement.delta_souris = clic.delta
    évènement.action_souris = clic.action
}

/** \} */
