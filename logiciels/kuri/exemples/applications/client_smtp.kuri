importe Fondation

//https://tools.ietf.org/html/rfc5321#page-32
//https://fr.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol
/*

S: 220 smtp.xxxx.xxxx SMTP Ready
C: HELO client
S: 250-smtp.xxxx.xxxx
S: 250-PIPELINING
S: 250 8BITMIME
C: MAIL FROM: <auteur@yyyy.yyyy>
S: 250 Sender ok
C: RCPT TO: <destinataire@xxxx.xxxx>
S: 250 Recipient ok.
C: DATA
S: 354 Enter mail, end with "." on a line by itself
C: Subject: Test
C:
C: Corps du texte
C: .
S: 250 Ok
C: QUIT
S: 221 Closing connection
Connection closed by foreign host.

*/

CodeRetour :: énum z32 {
	// Informationnel
	SERVEUR_NE_PEUT_SE_CONNECTER :: 101
	CONNEXION_REFUSÉE            :: 111

	// Succès
	MESSAGE :: 200
	RÉPONSE_COMMANDE_HELP :: 214
	SERVEUR_PRÊT :: 220
	FERMETURE_CANAL_TRANSMISSION :: 221
	ACTION_REQUISE_COMPLÉTÉE :: 250
	UTILISATION_NON_LOCAL_DEVRA_PROJETÉ :: 251
	NE_PEUT_VÉRIFIER_UTILISATEUR_MAIS_DELIVRE_QUAND_MÊME :: 252

	// Redirection
	COMMENCE_ENTRÉE_COURRIEL :: 354

	// Persistent transient failure
	PROBLÈME_CONNEXION_TIMEOUT :: 420
	SERVICE_NON_DISPONIBLE_À_CAUSE_CONNEXION :: 421
	BOÎTE_PLEINE :: 422
	MANQUE_ESPACE_DISQUE :: 431
	FILE_COURRIEL_DESTINATAIRE_EST_STOPPÉE :: 432
	SERVEUR_DESTINATAIRE_NE_RÉPOND_PAS :: 441
	CONNEXION_ABONDONNÉE_DURANT_TRANSMISSION :: 442
	COMPTE_HOP_EXCÉDÉ_POUR_LE_MESSAGE :: 446
	MESSAGE_TIMOUT :: 447
	ERREUR_ROUTAGE :: 449
	BOÎTE_COURRIEL_INDISPONIBLE :: 450
	ERREUR_LOCAL_LORS_DU_PROCÈS :: 451
	TROP_DE_COURRIELS_ENVOYÉS_OU_TROP_DE_DESTINATAIRES :: 452
	ERREUR_INTERNE :: 471

	// Erreurs permanentes
	ERREUR_DE_SYNTAXE :: 500
	ERREUR_DE_SYNTAXE_PARAMÈTRE_OU_ARGUMENT :: 501
	MAUVAISE_SÉQUENCE_DE_COMMANDE_OU_NON_AUTHENTIFIÉ :: 503
	PARAMÈTRE_DE_COMMANDE_NON_IMPLÉMENTÉ :: 504
	MAUVAISE_ADRESSE_COURRIEL :: 510
	MAUVAISE_ADRESSE_COURRIEL_ :: 511
	DNS_SERVEUR_DU_DESTINATAIRE_INTROUVABLE :: 512
	TYPE_ADRESSE_INCORRECT :: 513
	TAILE_DU_COURRIEL_TROP_GRANDE :: 523
	PROBLÈME_AUTHENTIFICATION :: 530
	DESTINATAIRE_REJETTE_LE_MESSAGE :: 541
	ADRESSE_COURRIEL_INEXISTANTE :: 550
	UTILISATEUR_NON_LOCAL_OU_ADRESSE_INVALIDE :: 551
	ALLOCATION_STOCKAGE_EXCÉDÉE :: 552
	NOM_BOITE_COURRIEL_INVALIDE :: 553
	TRANSACTION_ÉCHOUÉE :: 554
}

principale :: fonc () -> z32
{
	imprime("S > 220 smtp.delsace.fr SMTP Ready\n")

	enchaineuse : Enchaineuse
	initialise_enchaineuse(@enchaineuse)
	diffère { détruit_enchaineuse(@enchaineuse) }

	boucle {
		imprime("C > ")

		entrée := lis_entrée()

		si entrée.commence_par("HELO") {
			imprime("250 smtp.delsace.fr, heureux de vous rencontrer\r\n")
			//imprime("250 PIPELINING\r\n")
			//imprime("250 8BITMIME\r\n")
		}
		sinon si entrée.commen_par("MAIL FROM") {
			imprime("250 Sender Ok\r\n")
		}
		sinon si entrée.commence_par("RCPT TO:") {
			imprime("250 Recipient ok\r\n")
		}
		sinon si entrée.commence_par("DATA") {
			imprime("354 Entrez courriel, terminez par <CR><LF>.<CR><LF>\r\n")
		}
		sinon si entrée.commence_par("QUIT") {
			imprime("221 Au revoir\r\n")
			arrête
		}
		sinon {
			// accumule le mail
			si entrée == ".\r\n" {
				// fin du mail
				id := 5
				imprime("250 Ok, enfiler comme %\r\n", id)
			}
			sinon {
				ajoute_au_tampon(@enchaineuse, entrée)
			}
		}
	}

	imprime("\nEnvoie du mail :\n%\n")

	retourne 0
}
